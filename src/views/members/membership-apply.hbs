{{#if url}}
<html>
<head>
  <title>Redirecting...</title>
  <script>
    window.location.href = "{{url}}";
  </script>
</head>
<body>
  <p>If you are not redirected, <a href="{{url}}">click here</a>.</p>
</body>
</html>
{{else}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membership Application - WhyGym</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <style>
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        #myTable td {
            vertical-align: top;
        }        
        
        .step {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background: white;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .step.active {
            border-color: #16a34a;
            color: #16a34a;
        }
        
        .step.completed {
            background-color: #16a34a;
            border-color: #16a34a;
            color: white;
        }
        
        .step-connector {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #e5e7eb;
            transform: translateY(-50%);
            z-index: 0;
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
        }
        
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-4">
        <!-- Header -->
        <div class="flex justify-between items-center p-4 bg-white rounded-xl shadow-sm mb-6">
            <h1 class="text-xl font-bold text-green-800">WhyGym</h1>
            <a href="/user-dashboard" class="text-green-600 hover:text-green-700 text-sm font-medium">Back to Dashboard</a>
        </div>

        <!-- Application Form -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="p-6 border-b border-gray-100">
                <h2 class="text-2xl font-semibold text-gray-900">Membership Application</h2>
                <p class="mt-2 text-gray-600">Please fill out all required information below.</p>
            </div>

            <!-- Step Indicator -->
            <div class="p-6 border-b border-gray-100">
                <div class="step-indicator">
                    <div class="step-connector"></div>
                    <div class="step active" data-step="1">1</div>
                    <div class="step" data-step="2">2</div>
                    <div class="step" data-step="3">3</div>
                </div>
            </div>

            <form id="membershipForm" action="/members/membership-apply" method="POST" class="p-6">
                <!-- Section 1: Personal Information -->
                <div class="form-section active space-y-6" data-section="1">
                    <h3 class="text-xl font-semibold mb-6">Personal Information</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Email utama group/duo (atau emailmu jika membership single)
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="email" name="emailPic" data-default="{{ user.email }}" id="email-pic-input" autofocus
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 bg-yellow-100" required>
                            <div class="error-message"></div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Durasi membership
                                <span class="text-red-500">*</span>
                            </label>
                            <select name="duration" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500 bg-yellow-100" required>
                                <option value="">Pilih durasi</option>
                                <option value="90">90 hari (3 bulan)</option>
                                <option value="180">180 hari (6 bulan)</option>
                                <option value="360">360 hari (12 bulan)</option>
                            </select>
                        </div>

                        <div class="bg-yellow-100 border-yellow-500 border-2 rounded-md p-4">
                            <p>KHUSUS PAKET DUO / GROUP, INFORMASI DI ATAS HARUS SAMA UNTUK SEMUA PENDAFTAR</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Nama Lengkap
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="fullName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Nickname
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="nickname" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Jenis Kelamin
                                <span class="text-red-500">*</span>
                            </label>
                            <select name="gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                                <option value="">Pilih jenis kelamin</option>
                                <option value="male">Pria</option>
                                <option value="female">Wanita</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Tanggal Lahir
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="date" 
                                   name="dateOfBirth" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" 
                                   required
                                   max="{{ getCurrentDate }}"
                                   data-min-age="12">
                            <div class="error-message"></div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Alamat lengkap
                                <span class="text-red-500">*</span>
                            </label>
                            <textarea name="address" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" required></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Nomor Whatsapp
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="tel" name="wa" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Nomor Identitas (KTP/SIM/Kartu Pelajar)
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="identityNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Kondisi Kesehatanmu (tuliskan jika ada kondisi kesehatan khusus yang berpengaruh pada aktivitas olahraga)
                                <span class="text-red-500">*</span>
                            </label>
                            <select name="healthConditionPreset" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" onchange="handleHealthConditionChange(this)">
                                <option value="none">Saya dalam kondisi sehat untuk melakukan aktivitas fisik</option>
                                <option value="other">Lainnya (tuliskan)</option>
                            </select>
                            <input type="text" 
                                   name="healthCondition" 
                                   id="customHealthCondition" 
                                   class="mt-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" 
                                   placeholder="Tuliskan kondisi kesehatan Anda"
                                   style="display: none;">
                            <div class="error-message"></div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Under 18 Information -->
                <div class="form-section space-y-6" data-section="2">
                    <h3 class="text-xl font-semibold mb-6">Informasi Wali (Untuk Member Dibawah 18 Tahun)</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Nama Orang Tua/Wali
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="parentName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Nomor Identitas Orang Tua/Wali
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="text" name="parentIdentityNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Nomor Telepon Orang Tua/Wali
                                <span class="text-red-500">*</span>
                            </label>
                            <input type="tel" name="parentContact" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
                        </div>

                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" name="underageConsent" class="rounded border-gray-300 text-green-600 shadow-sm focus:border-green-500 focus:ring-green-500">
                                <span class="ml-2 text-sm text-gray-700">
                                    Saya, selaku orang tua/wali, memberikan izin kepada anak saya
                                    <span class="text-red-500">*</span>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Terms and Conditions -->
                <div class="form-section space-y-6" data-section="3">
                    <h3 class="text-xl font-semibold mb-6">Persetujuan dan Syarat Ketentuan</h3>
                    <table id="myTable" border="1" cellspacing="0" cellpadding="0" style="font-size: 13px;">
                        <tbody>
                            <tr><td>1.</td><td><strong>Definisi</strong></td></tr>
                            <tr><td>1.1.</td><td><strong>Whygym</strong> adalah Pusat kebugaran (gym) yang dimiliki dan/atau dioperasikan oleh PT Saatnya Kita Ngegym beserta afiliasinya.</td></tr>
                            <tr><td>1.2.</td><td><strong>Member</strong> adalah Setiap individu yang telah terdaftar dan memiliki hak menggunakan fasilitas dan layanan Whygym berdasarkan program yang aktif.</td></tr>
                            <tr><td>1.3.</td><td><strong>Program</strong> adalah semua bentuk layanan Whygym baik berupa: membership area gym, jasa  personal trainer, aktivitas kelas khusus di functional room, dll.</td></tr>
                            <tr><td>1.4.</td><td><strong>Pihak Ketiga</strong> adalah pihak lain yang bekerjasama dengan Whygym seperti: pelatih tamu, vendor, event organizer, dll.</td></tr>
                            <tr><td>2.</td><td><strong>Deskripsi Layanan</strong></td></tr>
                            <tr><td>2.1.</td><td>Whygym menyediakan fasilitas olahraga dan pendidikan berupa: membership area gym, jasa  personal trainer, aktivitas kelas khusus di functional room, dll.</td></tr>
                            <tr><td>2.2.</td><td>Whygym dapat menyelenggarakan kegiatan tambahan seperti seminar kebugaran, program monitoring nutrisi, kompetisi internal antar member, atau event lain yang relevan dengan dunia olahraga dan kebugaran.</td></tr>
                            <tr><td>2.3.</td><td>Whygym berhak melakukan modifikasi, penambahan, atau pengurangan pada jenis dan kapasitas layanan kapan pun dianggap perlu, dan akan melakukan pemberitahuan kepada Member jika perubahan yang dilakukan dianggap mempengaruhi aktifitas member secara umum.</td></tr>
                            <tr><td>3.</td><td><strong>Penerimaan Member dan Durasi Program</strong></td></tr>
                            <tr><td>3.1.</td><td><strong>Pendaftaran</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Calon Member wajib mengisi formulir pendaftaran dengan data lengkap dan benar, serta menandatangani (fisik atau digital) bahwa mereka memahami dan menyetujui Ketentuan dan Syarat keanggotan ini.</td></tr>
                            <tr>
                                <td>3.2.</td>
                                <td><strong>Jenis Keanggotaan</strong></td>
                            </tr>
                            <tr>
                                <td class="text-right"> •&nbsp;</td>
                                <td>Whygym dapat menawarkan beberapa durasi membership : 3 bulan, 6 bulan, 12 bulan dll. Detail hak dan akses tercantum pada paket keanggotan member.</td>
                            </tr>
                            <tr><td>3.3.</td><td><strong>Masa Berlaku</strong></td></tr>
                            <tr>
                                <td class="text-right"> •&nbsp;</td>
                                <td>Masa aktif berlaku sesuai periode program membership yang dipilih. Apabila masa berlaku berakhir, Member dapat memperpanjang membership, sesuai dengan penetapan aturan dan harga yang baru.</td></tr>
                            <tr><td>3.4.</td><td><strong>Keanggotaan di Bawah Umur</strong></td></tr>
                            <tr>
                                <td class="text-right"> •&nbsp;</td>
                                <td>
                                    Bagi member di bawah 18 tahun, pendaftaran harus disertai persetujuan dari orang tua/wali, sehingga tanggung jawab pengawasan atas aktivitas member sepenuhnya ada pada orang tua/wali.
                                </td>
                            </tr>
                            <tr>
                                <td class="text-right"> •&nbsp;</td>
                                <td>
                                    Whygym dapat memberlakukan pembatasan penggunaan fasilitas tertentu atau jam tertentu bagi Member di bawah umur.
                                </td>
                            </tr>
                            <tr><td>4.</td><td><strong>Hak dan Kewajiban Para Pihak</strong></td></tr>
                            <tr><td>4.1.</td><td><strong>Hak Whygym</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Menentukan, mengubah, atau menyesuaikan jenis layanan, jam operasional, biaya, dan aturan penggunaan fasilitas dengan pemberitahuan kepada Member.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Menolak atau membatalkan Membership apabila Member melanggar ketentuan atau berpotensi membahayakan keselamatan/kesehatan di lingkungan Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym tidak berkewajiban untuk mengembalikan biaya berlangganan jika pembatalan membership dilakukan karena kesalahan atau kondisi dari member.</td></tr>
                            <tr><td>4.2.</td><td><strong>Kewajiban Whygym</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Memberikan layanan kebugaran dan fasilitas sesuai standar keamanan dan kualitas yang wajar.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Melakukan pemeliharaan rutin terhadap peralatan kebugaran dan fasilitas lain.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Menjaga data pribadi member dan merahasiakannya sesuai hukum yang berlaku.</td></tr>
                            <tr><td>4.3.</td><td><strong>Hak Member</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Mendapatkan akses dan penggunaan fasilitas sesuai paket membership yang diambil.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Menerima informasi terkait perubahan layanan, biaya, atau program baru.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Menyampaikan keluhan atau masukan kepada manajemen Whygym untuk peningkatan layanan.</td></tr>
                            <tr><td>4.4.</td><td><strong>Kewajiban Member</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Mematuhi seluruh aturan, kebijakan, dan instruksi keselamatan yang berlaku di Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Menghormati privasi dan kenyamanan Member lain saat menggunakan fasilitas. Termasuk tidak membuat dokumentasi yang merekam aktivitas member lain tanpa persetujuan dari yang bersangkutan.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Menggunakan peralatan sesuai panduan dan mengembalikannya ke tempat semula setelah digunakan.</td></tr>
                            <tr><td>5.</td><td><strong>Aturan Pembayaran</strong></td></tr>
                            <tr><td>5.1.</td><td><strong>Biaya Keanggotaan</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Besaran biaya, jenis, dan periode pembayaran tercantum dalam paket yang disepakati.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berhak mengubah biaya keanggotaan untuk masa aktif keanggotaan yang baru tanpa membebani keanggotaan member yang telah berjalan.</td></tr>
                            <tr><td>5.2.</td><td><strong>Metode Pembayaran</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Pembayaran dapat dilakukan secara tunai, transfer bank, kartu debit, atau metode lain yang difasilitasi oleh Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym tidak menerima pembayaran tempo / cicilan.</td></tr>
                            <tr><td>5.3.</td><td><strong>Keterlambatan Pembayaran</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Apabila Member belum melakukan pembayaran, Whygym berhak menangguhkan akses ke fasilitas sampai kewajiban pembayaran dipenuhi.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Denda atau biaya administrasi keterlambatan (jika ada) akan diinformasikan secara terpisah.</td></tr>
                            <tr><td>6.</td><td><strong>Kebijakan Pembatalan dan Pengembalian Dana (Refund)</strong></td></tr>
                            <tr><td>6.1.</td><td><strong>Pembatalan oleh Member</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member dapat mengajukan pembatalan keanggotaan sebelum masa berlaku habis dengan mengirimkan permohonan tertulis (fisik atau digital) kepada manajemen Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Pengembalian dana dimungkinkan dengan mengikuti kebijakan yang berlaku di whygym dengan mengenakan potongan administrasi atau biaya lain.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berhak tidak mengembalikan dana membership jika pembatalan keanggotaan dinilai : tidak beralasan kuat atau bukan merupakan kesalahan pihak whygym.</td></tr>
                            <tr><td>6.2.</td><td><strong>Pembatalan oleh Whygym</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berhak membatalkan keanggotaan secara sepihak jika Member melanggar ketentuan, melakukan tindakan kriminal, atau membahayakan pihak lain.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Biaya yang telah dibayarkan tidak dikembalikan apabila Member dibatalkan keanggotaannya karena pelanggaran berat.</td></tr>
                            <tr><td>6.3.</td><td><strong>Kebijakan Freeze / Cuti</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym menyediakan opsi cuti (freeze) keanggotaan dengan syarat tertentu semisal dengan alasan : sakit berkepanjangan, cedera, cuti yang diatur oleh Undang-Undang, perjalanan dinas jangka panjang dll.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Durasi freeze serta biaya admin akan diatur dalam kebijakan internal Whygym.</td></tr>
                            <tr><td>7.</td><td><strong>Persetujuan Pemrosesan Data Pribadi</strong></td></tr>
                            <tr><td>7.1.</td><td><strong>Pengumpulan Data</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym mengumpulkan data pribadi Member (nama, kontak, riwayat kesehatan, dll.) untuk tujuan administrasi, pelayanan, promosi internal, dan keperluan hukum.</td></tr>
                            <tr><td>7.2.</td><td><strong>Penggunaan Data</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym tidak akan membagikan data pribadi Member kepada pihak ketiga tanpa persetujuan, kecuali diwajibkan oleh hukum atau diperlukan untuk penegakan perjanjian ini (mis. penagihan).</td></tr>
                            <tr><td>7.3.</td><td><strong>Perlindungan Data</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berkomitmen menjaga kerahasiaan data pribadi Member sesuai peraturan perundang-undangan dan akan mengambil langkah keamanan yang wajar untuk mencegah akses tidak sah.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berhak memonitor kegiatan member melalui CCTV untuk kepentingan keamanan dan kenyamanan. Adapun whgym berkomitmen untuk hanya memberikan akses CCTV kepada karyawati wanita, demi menjaga privasi dan kehormatan member khususnya wanita.</td></tr>
                            <tr><td>8.</td><td><strong>Penggunaan dan Tanggung Jawab Pelanggan</strong></td></tr>
                            <tr><td>8.1.</td><td><strong>Jam Operasional</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym bogor menerapkan jam khusus wanita dan pria untuk mengakses area gym dengan ketentuan sebagai berikut : </td></tr>
                            <tr><td class="text-right"></td>
                                <td>
                                    <table>
                                        <tr>
                                            <td> ○ </td>
                                            <td>06.00 - 18.00 Khusus Perempuan</td>
                                        </tr>
                                        <tr>
                                            <td> ○ </td>
                                            <td>18.00 - 23.59: Khusus Laki-laki</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym dapat mengubah jam operasional sewaktu-waktu dengan melakukan pemberitahuan resmi sebelumnya.</td></tr>
                            <tr><td>8.2.</td><td><strong>Kondisi Kesehatan</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member bertanggung jawab memeriksakan kesehatannya sebelum memulai program latihan intensif.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member dilarang berolahraga jika sedang mengalami sakit menular, cedera serius, atau kondisi medis lain yang dapat membahayakan diri sendiri atau member lain.</td></tr>
                            <tr><td>8.3.</td><td><strong>Barang Pribadi</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member bertanggung jawab terhadap barang dan kendaraan pribadinya. Whygym tidak bertanggung jawab atas kehilangan atau kerusakan barang dan kendaraan member.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Kendati demikian, Whygym berkomitmen untuk menjaga keamanan barang dan kendaraan member, lewat penjagaan security dan juga penyediaan loker.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Disarankan menggunakan loker yang disediakan dan mengunci dengan benar.</td></tr>
                            <tr><td>9.</td><td><strong>Larangan dan Sanksi</strong></td></tr>
                            <tr><td>9.1.</td><td><strong>Larangan</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Membawa atau mengonsumsi alkohol, narkotika, zat haram, atau zat berbahaya lain di area Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Tindak kekerasan, pelecehan verbal, pelecehan seksual, atau tindakan kriminal lainnya.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Merusak fasilitas atau peralatan Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Melakukan atau mempromosikan perilaku LGBT dan sejenisnya di area Whygym.</td></tr>
                            <tr><td>9.2.</td><td><strong>Sanksi</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berhak memberikan sanksi mulai dari teguran, skors sementara, hingga pembatalan keanggotaan secara permanen apabila Member melanggar larangan yang ditetapkan.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Biaya yang telah dibayarkan tidak akan dikembalikan jika keanggotaan dibatalkan karena pelanggaran berat.</td></tr>
                            <tr><td>10.</td><td><strong>Klausul Wanprestasi</strong></td></tr>
                            <tr><td>10.1.</td><td><strong>Pengertian Wanprestasi</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Wanprestasi terjadi jika salah satu pihak tidak melaksanakan kewajiban dalam perjanjian ini atau melaksanakannya secara tidak benar.</td></tr>
                            <tr><td>10.2.</td><td><strong>Tindakan atas Wanprestasi</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Pihak yang dirugikan berhak menuntut ganti rugi sesuai hukum yang berlaku.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berhak menangguhkan atau menghentikan layanan kepada Member yang wanprestasi, termasuk menunggak pembayaran atau melanggar ketentuan.</td></tr>
                            <tr><td>10.3.</td><td><strong>Upaya Penyelesaian</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Sebelum menempuh jalur hukum, para pihak diharapkan melakukan musyawarah untuk mencari solusi terbaik.</td></tr>
                            <tr><td>11.</td><td><strong>Klausul Force Majeure</strong></td></tr>
                            <tr><td>11.1.</td><td><strong>Keadaan Kahar</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym dibebaskan dari tanggung jawab apabila terjadi keadaan kahar di luar kendali (bencana alam, kebakaran, banjir, pandemi, kerusuhan, pemogokan, kebijakan pemerintah, dll.) yang mengakibatkan penutupan atau gangguan operasional.</td></tr>
                            <tr><td>11.2.</td><td><strong>Konsekuensi Force Majeure</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Kewajiban Whygym untuk memberikan layanan dapat ditangguhkan selama periode force majeure berlangsung.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member tidak dapat menuntut ganti rugi atas ketidaknyamanan atau kerugian akibat force majeure, namun Whygym dapat memberikan kebijakan tertentu sesuai situasi.</td></tr>
                            <tr><td>12.</td><td><strong>Kerahasiaan</strong></td></tr>
                            <tr><td>12.1.</td><td><strong>Informasi Rahasia</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Segala informasi tentang Whygym yang tidak bersifat publik (strategi bisnis, data Member lain, prosedur internal) wajib dijaga kerahasiaannya oleh Member.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member dilarang menyewa jasa trainer Whygym tanpa persetujuan dari Whygym.</td></tr>
                            <tr><td>12.2.</td><td><strong>Pelanggaran Kerahasiaan</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Pelanggaran klausul kerahasiaan dapat berakibat sanksi administratif hingga gugatan hukum, tergantung berat-ringannya pelanggaran.</td></tr>
                            <tr><td>13.</td><td><strong>Hak Kekayaan Intelektual</strong></td></tr>
                            <tr><td>13.1.</td><td><strong>Konten dan Materi</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Seluruh hak atas desain, logo, merek dagang, materi promosi, dan konten digital (video, foto, artikel) milik Whygym dilindungi undang-undang.</td></tr>
                            <tr><td>13.2.</td><td><strong>Pembatasan Penggunaan</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member tidak diperkenankan menggandakan, menyebarluaskan, atau memodifikasi konten dan materi milik Whygym tanpa izin tertulis dari pemilik Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Pelanggaran hak kekayaan intelektual dapat ditindak sesuai hukum yang berlaku.</td></tr>
                            <tr><td>14.</td><td><strong>Risiko dan Pelepasan Tanggung Jawab</strong></td></tr>
                            <tr><td>14.1.</td><td><strong>Penerimaan Risiko</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member memahami bahwa aktivitas latihan fisik di Whygym mengandung risiko cedera, cacat permanen, penyakit, hingga kematian.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member bertanggung jawab untuk mengelola resiko tersebut atau tidak memaksakan diri dalam berolahraga sesuai dengan kondisi member.</td></tr>
                            <tr><td>14.2.</td><td><strong>Pelepasan Tanggung Jawab</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member membebaskan Whygym (termasuk pemilik, karyawan, instruktur, dan afiliasi) dari segala tuntutan atas cedera, penyakit, cacat, atau kematian yang mungkin terjadi akibat aktivitas di Whygym.</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Member bertanggung jawab penuh atas kesehatannya, termasuk memonitor tekanan darah dan kondisi fisik lainnya.</td></tr>
                            <tr><td>15.</td><td><strong>Perubahan dan Modifikasi Program</strong></td></tr>
                            <tr><td>15.1.</td><td><strong>Perubahan Program</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Whygym berhak menambah, mengurangi, atau mengubah jenis program latihan, jadwal kelas, instruktur, dan fasilitas lain dengan mempertimbangkan kenyamanan Member.</td></tr>
                            <tr><td>15.2.</td><td><strong>Pemberitahuan</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Pemberitahuan perubahan akan disampaikan melalui sarana yang sesuai (papan pengumuman, aplikasi, email, atau media sosial).</td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Jika dalam kurun waktu tertentu (misalnya 14 hari) setelah pemberitahuan, Member tetap menggunakan layanan, maka dianggap setuju dengan perubahan tersebut.</td></tr>
                            <tr><td>16.</td><td><strong>Penyelesaian Sengketa</strong></td></tr>
                            <tr><td>16.1.</td><td><strong>Musyawarah untuk Mufakat</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Setiap perselisihan yang timbul dari pelaksanaan ketentuan ini diupayakan diselesaikan terlebih dahulu secara musyawarah.</td></tr>
                            <tr><td>16.2.</td><td><strong>Hukum yang Berlaku dan Yurisdiksi</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Jika musyawarah tidak mencapai kesepakatan, sengketa akan diselesaikan berdasarkan hukum yang berlaku di Indonesia melalui lembaga peradilan yang berwenang.</td></tr>
                            <tr><td>16.3.</td><td><strong>Biaya Sengketa</strong></td></tr>
                            <tr><td class="text-right"> •&nbsp;</td><td>Biaya penyelesaian sengketa (pengacara, pengadilan, dsb.) ditanggung pihak masing-masing kecuali ditentukan lain oleh putusan pengadilan atau kesepakatan bersama.</td></tr>
                        </tbody>
                    </table>
                        
                    
                    <div class="space-y-4">
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" name="termsAgree" class="rounded border-gray-300 text-green-600 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                                <span class="ml-2 text-sm text-gray-700">
                                    Saya telah membaca dan menyetujui seluruh poin dan pasal ketentuan
                                    <span class="text-red-500">*</span>
                                </span>
                            </label>
                        </div>

                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" name="riskAgree" class="rounded border-gray-300 text-green-600 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                                <span class="ml-2 text-sm text-gray-700">
                                    Saya menyadari dan menerima segala risiko yang mungkin terjadi saat menggunakan fasilitas WhyGym
                                    <span class="text-red-500">*</span>
                                </span>
                            </label>
                        </div>

                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" name="dataAgree" class="rounded border-gray-300 text-green-600 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                                <span class="ml-2 text-sm text-gray-700">
                                    Saya menyetujui pemrosesan data pribadi saya oleh WhyGym sesuai klausul yang berlaku
                                    <span class="text-red-500">*</span>
                                </span>
                            </label>
                        </div>

                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" name="rulesAgree" class="rounded border-gray-300 text-green-600 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                                <span class="ml-2 text-sm text-gray-700">
                                    Saya bersedia mematuhi semua aturan, sanksi, dan segala kebijakan lainnya yang ditetapkan WhyGym
                                    <span class="text-red-500">*</span>
                                </span>
                            </label>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">
                                Front Officer
                                <span class="text-red-500">*</span>
                            </label>
                            <select name="frontOfficer" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500" required>
                                <option value="">Pilih front officer</option>
                                <option value="Heru">Heru</option>
                                <option value="Maya">Maya</option>
                                <option value="Miftah">Miftah</option>
                                <option value="Rani">Rani</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="flex justify-between mt-8">
                    <button type="button" id="prevBtn" class="px-4 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" style="display: none;">
                        Previous
                    </button>
                    <button type="button" id="nextBtn" class="px-4 py-2 bg-green-600 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Next
                    </button>
                    <button type="submit" id="submitBtn" class="px-4 py-2 bg-green-600 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" style="display: none;">
                        Submit Application
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOMContentLoaded called");
            const form = document.getElementById('membershipForm');
            const sections = document.querySelectorAll('.form-section');
            const steps = document.querySelectorAll('.step');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');
            const submitBtn = document.getElementById('submitBtn');
            let currentSection = 0;

            // Function to show/hide sections
            function showSection(index) {
                sections.forEach((section, i) => {
                    section.classList.toggle('active', i === index);
                });

                steps.forEach((step, i) => {
                    step.classList.toggle('active', i === index);
                    step.classList.toggle('completed', i < index);
                });

                // Update buttons
                prevBtn.style.display = index === 0 ? 'none' : 'block';
                nextBtn.style.display = index === sections.length - 1 ? 'none' : 'block';
                submitBtn.style.display = index === sections.length - 1 ? 'block' : 'none';

                // Save current section to localStorage
                localStorage.setItem('currentSection', index);
            }

            // Handle next button click
            nextBtn.addEventListener('click', function() {
                if (validateSection(currentSection)) {
                    // Check if we're on section 1 and user is 18 or older
                    if (currentSection === 0) {
                        const dobInput = form.querySelector('input[name="dateOfBirth"]');
                        const age = calculateAge(new Date(dobInput.value));
                        if (age >= 18) {
                            // Skip section 2 for adults
                            currentSection = 2;
                        } else {
                            currentSection++;
                        }
                    } else {
                        currentSection++;
                    }
                    showSection(currentSection);
                    saveFormData();
                }
            });

            // Add calculateAge function
            function calculateAge(birthDate) {
                const today = new Date();
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                // Adjust age if birthday hasn't occurred this year
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
            }

            // Handle previous button click
            prevBtn.addEventListener('click', function() {
                currentSection--;
                showSection(currentSection);
            });

            // Form validation
            function validateSection(sectionIndex) {
                const currentSectionEl = sections[sectionIndex];
                const inputs = currentSectionEl.querySelectorAll('input[required], select[required], textarea[required]');
                let isValid = true;
                let firstError = null;

                inputs.forEach(input => {
                    if (!input.value) {
                        isValid = false;
                        showError(input);
                        if (!firstError) {
                            firstError = input;
                        }
                    } else {
                        clearError(input);
                    }
                });

                // If there are errors, scroll to the first one
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // Show a summary message at the top of the section
                    const existingAlert = currentSectionEl.querySelector('.error-summary');
                    if (!existingAlert) {
                        const alert = document.createElement('div');
                        alert.className = 'error-summary bg-red-50 border-l-4 border-red-500 p-4 mb-4';
                        alert.innerHTML = `
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-red-700">
                                        Mohon lengkapi semua field yang bertanda bintang (*)
                                    </p>
                                </div>
                            </div>
                        `;
                        currentSectionEl.querySelector('h3').insertAdjacentElement('afterend', alert);
                    }
                } else {
                    // Remove error summary if all fields are valid
                    const existingAlert = currentSectionEl.querySelector('.error-summary');
                    if (existingAlert) {
                        existingAlert.remove();
                    }
                }

                return isValid;
            }

            // Show error message
            function showError(input) {
                input.classList.add('border-red-500');
                const errorDiv = input.nextElementSibling;
                if (errorDiv && errorDiv.classList.contains('error-message')) {
                    errorDiv.textContent = 'This field is required';
                    errorDiv.style.display = 'block';
                }
            }

            // Clear error message
            function clearError(input) {
                input.classList.remove('border-red-500');
                const errorDiv = input.nextElementSibling;
                if (errorDiv && errorDiv.classList.contains('error-message')) {
                    errorDiv.style.display = 'none';
                }
            }

            // Save form data to localStorage
            function saveFormData() {
                const formData = new FormData(form);
                const data = {};
                // Special handling for checkboxes to ensure unchecked state is saved
                form.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    data[checkbox.name] = checkbox.checked;
                });
                // Handle all other form fields
                for (let [key, value] of formData.entries()) {
                    if (!data.hasOwnProperty(key)) { // Don't override checkbox values
                        data[key] = value;
                    }
                }
                localStorage.setItem('formData', JSON.stringify(data));
            }

            // Load saved form data
            function loadFormData() {
                const savedData = localStorage.getItem('formData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    for (let key in data) {
                        const input = form.elements[key];
                        if (input) {
                            if (input.type === 'checkbox') {
                                input.checked = data[key] === true; // Use strict boolean comparison
                            } else {
                                input.value = data[key];
                            }
                        }
                    }
                }

                // Restore current section
                const savedSection = localStorage.getItem('currentSection');
                if (savedSection !== null) {
                    currentSection = parseInt(savedSection);
                    showSection(currentSection);
                }
            }

            // Handle form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateSection(currentSection)) {
                    // Clear saved data
                    localStorage.removeItem('formData');
                    localStorage.removeItem('currentSection');
                    
                    // Submit the form
                    this.submit();
                }
            });

            // Load saved data when page loads
            loadFormData();

            // Add change event listeners to all inputs for auto-save
            form.querySelectorAll('input, select, textarea').forEach(input => {
                if (input.type === 'checkbox') {
                    // Special handling for checkboxes
                    input.addEventListener('change', function() {
                        saveFormData();
                        // Ensure the checkbox state is immediately saved
                        const data = JSON.parse(localStorage.getItem('formData') || '{}');
                        data[this.name] = this.checked;
                        localStorage.setItem('formData', JSON.stringify(data));
                    });
                } else {
                    input.addEventListener('change', saveFormData);
                }
            });

            // Modify the date of birth change handler
            const dobInput = form.querySelector('input[name="dateOfBirth"]');
            
            // Set max date to today
            const today = new Date();
            const maxDate = today.toISOString().split('T')[0];
            dobInput.setAttribute('max', maxDate);

            function validateAge(birthDate) {
                const today = new Date();
                const birth = new Date(birthDate);
                const minAge = parseInt(dobInput.dataset.minAge) || 12;
                
                let age = today.getFullYear() - birth.getFullYear();
                const monthDiff = today.getMonth() - birth.getMonth();
                
                // Adjust age if birthday hasn't occurred this year
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                    age--;
                }
                
                return age >= minAge;
            }

            dobInput.addEventListener('change', function() {
                const dob = new Date(this.value);
                const isValidAge = validateAge(dob);
                
                if (!isValidAge) {
                    showError(this);
                    this.value = ''; // Clear invalid date
                    const errorDiv = this.nextElementSibling;
                    if (errorDiv && errorDiv.classList.contains('error-message')) {
                        errorDiv.textContent = 'Member must be at least 12 years old';
                        errorDiv.style.display = 'block';
                    }
                    return;
                }
                
                clearError(this);
                const age = calculateAge(dob);
                
                // Show/hide under 18 section based on age
                if (age < 18) {
                    const parentFields = document.querySelectorAll('[name^="parent"]');
                    parentFields.forEach(field => field.required = true);
                    // If we're already past section 2, go back to it
                    if (currentSection > 1) {
                        currentSection = 1;
                        showSection(currentSection);
                    }
                } else {
                    const parentFields = document.querySelectorAll('[name^="parent"]');
                    parentFields.forEach(field => {
                        field.required = false;
                        field.value = '';
                    });
                    // If we're on section 2, skip to section 3
                    if (currentSection === 1) {
                        currentSection = 2;
                        showSection(currentSection);
                    }
                }
                
                saveFormData();
            });
            // Modify loadFormData to handle section skipping
            const originalLoadFormData = loadFormData;
            loadFormData = function() {
                originalLoadFormData();
                const savedData = localStorage.getItem('formData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    if (data.dateOfBirth) {
                        const age = calculateAge(new Date(data.dateOfBirth));
                        // If user is 18 or older and we're on section 2, skip to section 3
                        if (age >= 18 && currentSection === 1) {
                            currentSection = 2;
                            showSection(currentSection);
                        }
                    }
                }

                console.log("load from data called");
            };

            // Also modify handleHealthConditionChange to ensure proper value setting
            function handleHealthConditionChange(select) {
                const customInput = document.getElementById('customHealthCondition');
                if (select.value === 'other') {
                    customInput.style.display = 'block';
                    customInput.required = true;
                    if (!customInput.value) {
                        customInput.focus(); // Focus the input when shown
                    }
                } else {
                    customInput.style.display = 'none';
                    customInput.required = false;
                    customInput.value = select.options[select.selectedIndex].text;
                }
                saveFormData();
            }

            // Add the function to the window object to make it accessible from HTML
            window.handleHealthConditionChange = handleHealthConditionChange;

            // Initial trigger of health condition handling on page load
            const healthSelect = form.elements['healthConditionPreset'];
            if (healthSelect) {
                handleHealthConditionChange(healthSelect);
            }

            inputPic = document.getElementById('email-pic-input');
            //if input value pic is null or empty, set it to the default value
            if (inputPic.value === null || inputPic.value === '') {
                inputPic.value = inputPic.getAttribute('data-default');
            }
        });
    </script>
</body>
</html> 
{{/if}}